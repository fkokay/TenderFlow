@{
    ViewData["title"] = "Teminatlar";
}

<!-- Content -->

<h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">Teminatlar</span></h4>

<!-- DataTable with Buttons -->
<div class="card">
    <div class="card-datatable text-nowrap pt-0">
        <table id="Table" class="table table-bordered">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Firma</th>
                    <th>Konu</th>
                    <th>Teminat Belge No</th>
                    <th>Teminat Türü</th>
                    <th>Teminat Şekli</th>
                    <th>Teminat Tutarı</th>
                    <th>Teminat Kominsyon Oranı</th>
                    <th>Komisyon Dönemi</th>
                    <th>Toplam Komisyon Tutarı</th>
                    <th>Banka</th>
                    <th>Banka Şubesi</th>
                    <th>Ünvanı</th>
                    <th>Düzenlenme Tarihi</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
<!--/ DataTable with Buttons -->


@section VendorStyles {
    <link href="~/vendor/libs/datatables-bs5/datatables.bootstrap5.css" rel="stylesheet" />
    <link href="~/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css" rel="stylesheet" />
    <link href="~/vendor/libs/datatables-select-bs5/select.bootstrap5.css" rel="stylesheet" />
    <link href="~/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css" rel="stylesheet" />
    <link href="~/vendor/libs/datatables-fixedcolumns-bs5/fixedcolumns.bootstrap5.css" rel="stylesheet" />
    <link href="~/vendor/libs/datatables-fixedheader-bs5/fixedheader.bootstrap5.css" rel="stylesheet" />
    <link href="~/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css" rel="stylesheet" />
}

@section VendorScripts{
    <script src="~/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
}

@section PageScripts{
    <script>
        const table = $('#Table').DataTable({
            language: {
                paginate: {
                    next: '<i class="icon-base ti ti-chevron-right scaleX-n1-rtl icon-18px"></i>',
                    previous: '<i class="icon-base ti ti-chevron-left scaleX-n1-rtl icon-18px"></i>',
                    first: '<i class="icon-base ti ti-chevrons-left scaleX-n1-rtl icon-18px"></i>',
                    last: '<i class="icon-base ti ti-chevrons-right scaleX-n1-rtl icon-18px"></i>'
                },
                url: 'https://cdn.datatables.net/plug-ins/2.3.2/i18n/tr.json',
            },
            serverSide: true,
            order: [[0, 'asc']],
            ajax: {
                url: '/Guarantee/GuaranteeList',
                type: 'POST',
                contentType: 'application/json',
                data: function (d) {
                    return JSON.stringify(d);
                },
            },
            columns: [
                { data: 'Id', visible: false },
                { data: 'FirmName' },
                { data: 'Subject' },
                { data: 'GuaranteeNumber' },
                { data: 'GuaranteeType' },
                { data: 'GuaranteeForm' },
                { data: 'GuaranteeAmount' },
                { data: 'CommissionRate' },
                { data: 'GuaranteeCommissionPeriodName' },
                { data: 'CommissionAmount' },
                { data: 'BankName' },
                { data: 'BankBranchName' },
                { data: 'PublicAuthorityName' },
                { data: 'GuaranteeDate' }
            ],
            displayLength: 10,
            layout: {
                topStart: {
                    rowClass: "card-header d-flex border-top rounded-0 flex-wrap py-0 flex-column flex-md-row align-items-start",
                    features: [{
                        search: {
                            className: "me-5 ms-n4 pe-5 mb-n6 mb-md-0",
                            placeholder: "Ara..",
                            text: "_INPUT_"
                        }
                    }]
                },
                topEnd: {
                    rowClass: "row m-3 my-0 justify-content-between",
                    features: [{
                        pageLength: {
                            menu: [10, 25, 50, 100],
                            text: "_MENU_"
                        },
                        buttons: [
                            {
                                extend: "collection",
                                className: "btn btn-label-secondary dropdown-toggle me-4",
                                text: `<span class="d-flex align-items-center gap-1">
                                        <i class="icon-base ti ti-upload icon-xs"></i>
                                        <span class="d-none d-sm-inline-block">Dışarı Aktar</span>
                                      </span>`,
                                buttons: [
                                    {
                                        extend: "print",
                                        className: "dropdown-item",
                                        text: `<span class="d-flex align-items-center"><i class="icon-base ti tabler-printer me-1"></i> Print</span>`,
                                        exportOptions: { columns: [2, 3, 4] }
                                    },
                                    {
                                        extend: "csv",
                                        className: "dropdown-item",
                                        text: `<span class="d-flex align-items-center"><i class="icon-base ti tabler-file me-1"></i> Csv</span>`,
                                        exportOptions: { columns: [2, 3, 4] }
                                    },
                                    {
                                        extend: "excel",
                                        className: "dropdown-item",
                                        text: `<span class="d-flex align-items-center"><i class="icon-base ti tabler-upload me-1"></i> Excel</span>`,
                                        exportOptions: { columns: [2, 3, 4] }
                                    },
                                    {
                                        extend: "pdf",
                                        className: "dropdown-item",
                                        text: `<span class="d-flex align-items-center"><i class="icon-base ti tabler-file-text me-1"></i> Pdf</span>`,
                                        exportOptions: { columns: [2, 3, 4] }
                                    },
                                    {
                                        extend: "copy",
                                        className: "dropdown-item",
                                        text: `<i class="icon-base ti tabler-copy me-1"></i> Copy`,
                                        exportOptions: { columns: [2, 3, 4] }
                                    }
                                ]
                            },
                            {
                                text: `<i class="icon-base ti ti-plus me-0 me-sm-1 icon-16px"></i>
                                        <span class="d-none d-sm-inline-block">Yeni Ekle</span>`,
                                className: "add-new btn btn-primary",
                                action: function () {
                                    window.location.href = "Create";
                                }
                            }
                        ]
                    }]
                },
                bottomStart: {
                    rowClass: "row mx-3 justify-content-between",
                    features: ["info"]
                },
                bottomEnd: "paging"
            },
            scrollX: true,

            initComplete: function () {
            }
        });

        // Görsel sınıf düzeltmeleri
        setTimeout(() => {
            const adjustments = [
                { selector: ".dt-buttons .btn", classToRemove: "btn-secondary" },
                { selector: ".dt-buttons.btn-group", classToAdd: "mb-md-0 mb-6" },
                { selector: ".dt-search .form-control", classToRemove: "form-control-sm", classToAdd: "ms-0" },
                { selector: ".dt-search", classToAdd: "mb-0 mb-md-6" },
                { selector: ".dt-length .form-select", classToRemove: "form-select-sm" },
                { selector: ".dt-layout-end", classToAdd: "gap-md-2 gap-0 mt-0" },
                { selector: ".dt-layout-start", classToAdd: "mt-0" },
                { selector: ".dt-layout-table", classToRemove: "row mt-2" },
                { selector: ".dt-layout-full", classToRemove: "col-md col-12", classToAdd: "table-responsive" }
            ];
            adjustments.forEach(({ selector, classToRemove, classToAdd }) => {
                document.querySelectorAll(selector).forEach(el => {
                    if (classToRemove) classToRemove.split(" ").forEach(cls => el.classList.remove(cls));
                    if (classToAdd) classToAdd.split(" ").forEach(cls => el.classList.add(cls));
                });
            });
        }, 100);
    </script>
}